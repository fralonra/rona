<!doctype html><html lang=en><head><title>Reparing a corrupted file system :: Earon — Hail Earendil!</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="I occasionally ran into file system problems these days. At the fisrt few times, I just ran fsck and then reboot, but it failed today when my system tried to mount my home device, and systemctl status home.mount gave me the following errors:
home.mount: Mounting timed out. Terminating. home.mount: Mount process exited, code=killed, status=15/TERM home.mount: Failed with result 'timeout'. I noticed that I hadn&amp;rsquo;t used persistent block device naming in my fstab, so I edited the file to change the naming by label."><meta name=keywords content="linux,file system"><meta name=robots content="noodp"><link rel=canonical href=/posts/reparing-a-corrupted-file-system/><link rel=stylesheet href=/assets/style.css><link rel=stylesheet href=/assets/green.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/img/favicon/green.png><meta name=twitter:card content="summary"><meta name=twitter:title content="Reparing a corrupted file system :: Earon — Hail Earendil!"><meta name=twitter:description content="I occasionally ran into file system problems these days. At the fisrt few times, I just ran fsck and then reboot, but it failed today when my system tried to mount my home device, and systemctl status home.mount gave me the following errors:
home.mount: Mounting timed out. Terminating. home.mount: Mount process exited, code=killed, status=15/TERM home.mount: Failed with result 'timeout'. I noticed that I hadn&amp;rsquo;t used persistent block device naming in my fstab, so I edited the file to change the naming by label."><meta name=twitter:site content="/"><meta name=twitter:creator content="Fralonra"><meta name=twitter:image content><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Reparing a corrupted file system :: Earon — Hail Earendil!"><meta property="og:description" content="I occasionally ran into file system problems these days. At the fisrt few times, I just ran fsck and then reboot, but it failed today when my system tried to mount my home device, and systemctl status home.mount gave me the following errors:
home.mount: Mounting timed out. Terminating. home.mount: Mount process exited, code=killed, status=15/TERM home.mount: Failed with result 'timeout'. I noticed that I hadn&amp;rsquo;t used persistent block device naming in my fstab, so I edited the file to change the naming by label."><meta property="og:url" content="/posts/reparing-a-corrupted-file-system/"><meta property="og:site_name" content="Reparing a corrupted file system"><meta property="og:image" content><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2020-02-05 21:56:20 +0800 +0800"></head><body><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>/</div></a></div><div class=menu-trigger>menu</div></div></header><div class=content><div class=post><h1 class=post-title><a href=/posts/reparing-a-corrupted-file-system/>Reparing a corrupted file system</a></h1><div class=post-meta><span class=post-date>2020-02-05</span>
<span class=post-author>::
Fralonra</span></div><span class=post-tags>#<a href=/tags/linux/>linux</a>&nbsp;</span><div class=post-content><div><p>I occasionally ran into file system problems these days.
At the fisrt few times, I just ran <code>fsck</code> and then reboot, but it failed today when my system tried to mount my <code>home</code> device, and <code>systemctl status home.mount</code> gave me the following errors:</p><pre><code>home.mount: Mounting timed out. Terminating.
home.mount: Mount process exited, code=killed, status=15/TERM
home.mount: Failed with result 'timeout'.
</code></pre><p>I noticed that I hadn&rsquo;t used <a href=https://wiki.archlinux.org/index.php/Persistent_block_device_naming>persistent block device naming</a> in my <code>fstab</code>, so I edited the file to change the naming by label.
However, as a newbie, I forgot to set these labels before reboot, and as a result, my root partition left me as well! I found myself in the emergency shell (not in emergency mode anymore) and saw the terrifying words on my screen:</p><pre><code>Bailing out, you are on your own. Good luck.
</code></pre><p>I then relied on an <a href=https://antixlinux.com/>antiX</a> live-USB, and tried to mount the device to edit the <code>fstab</code>, but:</p><pre><code>NTFS signature is missing.
Failed to mount '/dev/xxx': Invalid argument
The device '/dev/xxx' doesn't seem to have a valid NTFS.
Maybe the wrong device is used? Or the whole disk instead of a
partition (e.g. /dev/sda, not /dev/sda1)? Or the other way around?
</code></pre><p>It seemed like the device was treated as ntfs, though it was indeed an ext4 partition, so I added <code>-t ext4</code> to the command, but also with no luck that time:</p><pre><code>mount: wrong fs type, bad option, bad superblock on /dev/xxx
</code></pre><p>I tried <code>fsck</code> and it gave me something like the following:</p><pre><code>fsck: Attempt to read block from filesystem resulted in short read while trying to open /dev/xxx
Could this be a zero-length partition?
</code></pre><p>As the error suggested, the <a href=https://ext4.wiki.kernel.org/index.php/Ext4_Disk_Layout#The_Super_Block>superblock</a> of the partition might have been corrupted.
I then found all the superblock backups by <code>mke2fs -n /dev/xxx</code>, and restored the superblock using one of them by <code>e2fsck /dev/xxx -b [superblock]</code>.
Finally, I ran <code>fsck</code> and <code>mount</code> again, and things went fine.</p></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button next"><a href=/posts/spacemacs/><span class=button__text>Spacemacs</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2020 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=/assets/main.js></script><script src=/assets/prism.js></script></div></body></html>